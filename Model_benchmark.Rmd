---
title: "Model_benchmark"
output: html_document
date: '2023-03-27'
---


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(timetk)
library(forecast)
library(tseries)
library(lubridate)
```


```{r}
prices <- read.csv("data/price_clean.csv") %>%
  mutate(
         hour_utc = lubridate::as_datetime(hour_utc),
         hour_dk = lubridate::as_datetime(hour_dk),
         spot_price_dkk = as.numeric(spot_price_dkk))
con <- read.csv("data/con_clean.csv")
prod <- read.csv("data/prod_clean.csv")
```


```{r}
prices <- prices %>%
  arrange(hour_utc) %>%
  filter(price_area == "DK1")

con <- con %>%
  arrange(hour_utc)

prod <- prod %>%
  filter(price_area == "DK1") %>%
  arrange(hour_utc)

prices["t"] <- 1:length(prices$spot_price_dkk)
prices["Hour"] <- hour(prices$hour_utc)
prices["Wday"] <- wday(prices$hour_utc, label=T)
prices["Week"] <- week(prices$hour_utc)
prices["Month"] <- month(prices$hour_utc)
prices["Year"] <- year(prices$hour_utc)
```


```{r}
prices %>% 
  plot_time_series(
    .date_var = hour_utc,
    .value = spot_price_dkk
  )
```

(auto.arima automatisk udv√¶lgelse)
```{r}
ts_df <- prices %>% 
  select(c(hour_utc, spot_price_dkk)) %>% 
  rename(datetime = hour_utc,
         value = spot_price_dkk)

# Convert the data to a ts object
ts_data <- ts(ts_df$value, frequency = 24)
```


# ARIMA
600 timers forecast.

AR(1)
```{r}
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(1, 0, 0),
             include.mean = T)
summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
acf(diff(prices$spot_price_dkk, 1))
pacf(diff(prices$spot_price_dkk, 1))
```


```{r}
#plot(AR1$residuals)
aTSA::arch.test(AR1)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals)
pacf(AR1$residuals)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```

AR(1) med first differencing
```{r}
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(1, 1, 0),
             include.mean = T)
summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals)
pacf(AR1$residuals)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```


AR(1) med seasonality og first differencing.
```{r}
AR1 <- arima(x=data$spot_price_dkk, 
             order=c(1, 1, 0), 
             seasonal = list(order=c(1, 1, 0), period=24))
summary(AR1)

plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals)
pacf(AR1$residuals)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```


AR1 med first differencing, seasonality og inverse hyperbolsk tangens transformation
```{r}
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(1, 1, 0), 
             seasonal = list(order=c(1, 0, 0), period=24),
             transform.pars=T)

summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals)
pacf(AR1$residuals)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```

SARIMA(1, 1, 0)(7, 0, 0)(24) med metode = conditional sum of squares, ellers sker der en fejl under numerisk optimering.
```{r}
fix_vec_AR <- c(NA)
fix_vec_SAR <- c(NA, NA, 0, 0, 0, 0, NA)
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(1, 1, 0), 
             fixed=c(fix_vec_AR, fix_vec_SAR), 
             seasonal = list(order=c(7, 0, 0), period=24), method = "CSS")

summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals)
pacf(AR1$residuals)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```


SARIMA(24, 1, 0)(7, 0, 0)(24) med metode = conditional sum of squares, ellers sker der en fejl under numerisk optimering.
```{r}
fix_vec_AR <- c(rep(0, 23), NA)
#fix_vec_AR <- c(rep(NA, 24))
fix_vec_MA <- c()
fix_vec_SAR <- c(NA, NA, 0, 0, 0, 0, NA)
#fix_vec_SAR <- c(rep(NA, 7))
fix_vec_SMA <- c()
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(24, 1, 0), 
             fixed=c(fix_vec_AR, fix_vec_MA, fix_vec_SAR, fix_vec_SMA), 
             seasonal = list(order=c(7, 0, 0), period=24), 
             method = "CSS")

summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals, lag.max=50)
pacf(AR1$residuals, lag.max=50)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```


SARIMA(1, 1, 24)(0, 0, 7)(24)
```{r}
#fix_vec_AR <- c(rep(0, 23), NA)
fix_vec_AR <- c(rep(NA, 1))
fix_vec_MA <- c(rep(NA, 24))
#fix_vec_SAR <- c(NA, NA, 0, 0, 0, 0, NA)
fix_vec_SAR <- c(rep(NA, 0))
fix_vec_SMA <- c(rep(NA, 7))
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(1, 1, 24), 
             fixed=c(fix_vec_AR, fix_vec_MA, fix_vec_SAR, fix_vec_SMA), 
             seasonal = list(order=c(0, 0, 7), period=24), 
             method = "CSS")

summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals, lag.max=1000)
pacf(AR1$residuals, lag.max=1000)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```


SARIMA(24, 1, 24)(7, 0, 0)(24)
```{r}
#fix_vec_AR <- c(rep(0, 23), NA)
fix_vec_AR <- c(rep(NA, 24))
fix_vec_MA <- c(rep(NA, 24))
#fix_vec_SAR <- c(NA, NA, 0, 0, 0, 0, NA)
fix_vec_SAR <- c(rep(NA, 7))
fix_vec_SMA <- c()
AR1 <- arima(x=prices$spot_price_dkk, 
             order=c(24, 1, 24), 
             fixed=c(fix_vec_AR, fix_vec_MA, fix_vec_SAR, fix_vec_SMA), 
             seasonal = list(order=c(7, 0, 0), period=24), 
             method = "CSS")

summary(AR1)
plot(prices$spot_price_dkk, type="l", xlim=c(25000, 27500))
lines(x=26809:27408 , y=as.data.frame(forecast(AR1, h=600))[,1], col="red")

plot(prices$spot_price_dkk, type="l", col=alpha("blue", 0.5))
lines(fitted(AR1), col=alpha("red", 0.5))
```

```{r}
plot(AR1$residuals)
kpss.test(AR1$residuals)
adf.test(AR1$residuals, k=1)
acf(AR1$residuals, lag.max=1000)
pacf(AR1$residuals, lag.max=1000)
hist(AR1$residuals, breaks=50)
qqnorm(AR1$residuals)
qqline(AR1$residuals)
```

```{r}
acf(diff(prices$spot_price_dkk, 1), lag.max=500)
pacf(diff(prices$spot_price_dkk, 1), lag.max=500)
```
Pacf viser SAR(7) er fornuftigt.




# VAR

# GARCH
```{r}
library(rugarch)
garch_spec <- ugarchspec(variance.model=list(model="sGARCH",garchOrder=c(1,1)),
                         mean.model=list(armaOrder=c(1,0)))

fit_garch <- ugarchfit(spec = garch_spec, data = prices$spot_price_dkk)
fit_garch
```

```{r}
plot(as.data.frame(fitted(fit_garch))[,1], type="l")
plot(prices$spot_price_dkk - as.data.frame(fitted(fit_garch))[,1], type="l")
```


# Day-ahead forecast

Funktion til forecast
```{r}
forecast_func <- function(days_ahead, data,
                          fix_vec_AR, d, fix_vec_MA, 
                          fix_vec_SAR, D, fix_vec_SMA,
                          Tperiod,
                          plotbool,
                          set_coefs) {
  training_data <- data[1:(length(data)-24*days_ahead)]
  validation_data <- data[(length(training_data)+1):length(data)]
  subset_training_data <- data[(length(training_data)-24*7-50):length(training_data)]
  
  forecasts <- c()
  
  start <- Sys.time()
  
  AR_f_coef <- set_coefs
  if(is.null(set_coefs)) {
    AR_f <- arima(x=training_data, 
                  order=c(length(fix_vec_AR), d, length(fix_vec_MA)), 
                  fixed = c(fix_vec_AR, fix_vec_MA, fix_vec_SAR, fix_vec_SMA),
                  seasonal = list(order=c(length(fix_vec_SAR), D, length(fix_vec_SMA)),
                                  period=Tperiod),
                  include.mean = F,
                  method="CSS")
    AR_f_coef <- AR_f$coef
  }
  
  for (i in 1:days_ahead){
    AR_f <- arima(x=subset_training_data,
                  order=c(length(fix_vec_AR), d, length(fix_vec_MA)), 
                  fixed = AR_f_coef,
                  seasonal = list(order=c(length(fix_vec_SAR), D, length(fix_vec_SMA)),
                                  period=Tperiod),
                  include.mean = F,
                  method="CSS")
    forecasts <- c(forecasts, as.data.frame(forecast(AR_f, h=24))[,1])
    subset_training_data <- c(subset_training_data, validation_data[(24*(i-1)+1):(24*i)])
  }
  end <- Sys.time()
  print(end-start)
  residuals <- validation_data-forecasts
  RMSE <- sqrt(mean(residuals^2))
  
  print(RMSE)
  if(plotbool == T) {
    plot(training_data, type="l", 
         xlim=c(length(training_data)-250, 26808+10), ylim=c(-500, 4500),
         main="Forecasts", xlab="Time", ylab="Price")
    lines(x=(length(training_data)+1):26808 , y=forecasts, col="blue")
    lines(x=(length(training_data)+1):26808 , y=validation_data, col=alpha("red", 0.5))
    legend("topright", inset=0.02, legend=c("Forecast", "Data"), col=c("blue", "red"), lty=1)
  }
  return(list(forecasts, residuals, RMSE, AR_f_coef))
}
```

## ARIMA(1, 1, 0)(0, 0, 0)(0)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,
                            c(NA), 1, c(), 
                            c(), 0, c(), 
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

## ARIMA(24, 1, 0)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(rep(0, 23), NA), 1, c(), 
                            c(), 0, c(), 
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(rep(NA, 24)), 1, c(), 
                            c(), 0, c(), 
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


## SARIMA(24, 1, 0)(7, 0, 0)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(rep(0, 23), NA), 1, c(), 
                            c(NA, NA, 0, 0, 0, 0, NA), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(rep(NA, 24)), 1, c(), 
                            c(rep(NA, 7)), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


## SARIMA(1, 1, 0)(7, 0, 0)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(NA), 1, c(), 
                            c(NA, NA, 0, 0, 0, 0, NA), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(NA), 1, c(), 
                            c(rep(NA, 7)), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

## SARIMA(24, 1, 0)(7, 1, 0)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(), 
                            c(rep(NA, 7)), 1, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


## SARIMA(24, 1, 1)(7, 0, 0)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(NA), 
                            c(rep(NA, 7)), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(0, 23), NA), 1, c(NA), 
                            c(rep(NA, 7)), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(0, 23), NA), 1, c(NA), 
                            c(NA, NA, 0, 0, 0, 0, NA), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```

## SARIMA(24, 1, 1)(7, 0, 1)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(NA), 
                            c(rep(NA, 7)), 0, c(NA),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(0, 23), NA), 1, c(NA), 
                            c(rep(NA, 7)), 0, c(NA),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(NA), 
                            c(NA, NA, 0, 0, 0, 0, NA), 0, c(NA),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 23), NA), 1, c(NA), 
                            c(NA, NA, 0, 0, 0, 0, NA), 0, c(NA),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


## SARIMA(24, 1, 24)(7, 0, 0)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(rep(NA, 24)), 
                            c(rep(NA, 7)), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


## SARIMA(24, 1, 24)(7, 0, 7)(24)
```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk,  
                            c(rep(NA, 24)), 1, c(rep(NA, 24)), 
                            c(rep(NA, 7)), 0, c(rep(NA, 7)),
                            24,
                            plotbool=T,
                            set_coefs=NULL)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]
print(AR_f_coef)

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


# Auto arima test
```{r}
autofit <- auto.arima(prices$spot_price_dkk, max.p=24, max.q=24, max.P=7, max.Q=7)
summary(autofit)
```


```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(NA, NA), 1, c(NA, NA), 
                            c(), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=autofit$coef)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```


Auto arima with initial model being our best model.
```{r}
autofit <- auto.arima(prices$spot_price_dkk, max.p=24, max.q=24, max.P=7, max.Q=7,
                      start.p=24, start.q=1, start.P=7, start.Q=1)
summary(autofit)
```


```{r}
outputlist <- forecast_func(28, prices$spot_price_dkk, 
                            c(rep(NA, 23)), 1, c(), 
                            c(), 0, c(),
                            24,
                            plotbool=T,
                            set_coefs=autofit$coef)
forecasts <- outputlist[[1]]
residuals <- outputlist[[2]]
RMSE <- outputlist[[3]]
AR_f_coef <- outputlist[[4]]

plot(residuals, type="l")
kpss.test(residuals)
adf.test(residuals, k=1)
hist(residuals, breaks=50)
qqnorm(residuals)
qqline(residuals)
```








